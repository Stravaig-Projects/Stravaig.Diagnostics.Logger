name: Build and Test Stravaig.Extensions.Logging.Diagnostics
on: 
  push:
    branches: 
      - main
  workflow_dispatch:
    inputs:
      isPublic:
        description: 'Is Public Release'     
        required: false
        default: false
      isPreview:
        description: 'Is Preview Release'
        required: false
        default: true

jobs:
  build:
    name: Stravaig Test Capture Logger
    runs-on: ubuntu-latest
    
    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: PWD
        run: |
          pwd

      - name: LS
        run: |
          ls -l -F -a

      - name: Set version number
        shell: pwsh
        run: ./Set-Version.ps1

      - name: Display Stuff
        run: |
          echo "Package version: $STRAVAIG_PACKAGE_VERSION"
          echo "Version Suffix: $STRAVAIG_PACKAGE_VERSION_SUFFIX"
          echo "isPublic: ${{ github.event.inputs.isPublic }}"
          echo "isPreview: ${{ github.event.inputs.isPreview }}"
          env
          

#
#      - uses: actions/setup-dotnet@v1
#        name: Setup .NET Core
#        with:
#          dotnet-version: 3.1.402
#          source-url: https://nuget.pkg.github.com/Stravaig-Projects/index.json
#        env:
#          NUGET_AUTH_TOKEN: ${{secrets.GITHUB_TOKEN}}#
#
#      - name: Build Solution
#        run: dotnet build src/Stravaig.Extensions.Logging.Diagnostics.sln --configuration Release
#        
#      - name: Run Tests
#        run: dotnet test src/Stravaig.Extensions.Logging.Diagnostics.Tests/Stravaig.Extensions.Logging.Diagnostics.Tests.csproj --configuration Release
#        
#      - name: Package Project
#        run: dotnet pack ./src/Stravaig.Extensions.Logging.Diagnostics/Stravaig.Extensions.Logging.Diagnostics.csproj --configuration Release --output ./out --include-symbols --include-source /p:VersionPrefix="0.0.2" --version-suffix "preview-$GITHUB_RUN_NUMBER" -p:IncludeSymbols=true -p:SymbolPackageFormat=snupkg
#        
#      - name: Push package to GitHub
#        run: dotnet nuget push ./out/*.nupkg
#        
#      - name: Push package Symbols to GitHub
#        run: dotnet nuget push ./out/*.snupkg
